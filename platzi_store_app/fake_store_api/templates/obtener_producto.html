{% extends 'base.html' %}

{% block title %} TIENDA AVILA'S - Productos {% endblock %}

{% block content %}
<div class="products-container">
    <!-- Header de la página -->
    <div class="page-header">
        <div class="header-content">
            <div class="title-section">
                <h1><i class="fas fa-store"></i> Catálogo de Productos</h1>
            </div>
            <div class="header-actions">
                <a href="{% url 'fake_store_api:agregar_producto' %}" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Agregar Producto
                </a>
            </div>
        </div>
    </div>

    <!-- Mensajes de Django -->
    {% if messages %}
        {% for message in messages %}
            <div class="notification notification-{{ message.tags }}" role="alert">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    {% if success %}
        <!-- Grid de productos -->
        <div class="products-grid" id="productsGrid">
            {% for producto in productos %}
                <div class="product-card" data-id="{{ producto.id }}">
                    
                    <div class="card-header">
                        <div class="product-id">#{{ producto.id }}</div>
                        <div class="card-actions">
                            <!-- BOTÓN DE EDITAR CORREGIDO -->
                            <a href="{% url 'fake_store_api:editar_producto' producto.id %}" class="action-btn edit-btn" title="Editar">
                                <i class="fas fa-edit"></i>
                            </a>
                            <button class="action-btn delete-btn" onclick="deleteProduct({{ producto.id }}, this)" title="Eliminar">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>

                    <div class="card-image-container">
                        {% if producto.images.0 %}
                            <img src="{{ producto.images.0 }}" alt="{{ producto.title }}" class="card-image">
                        {% else %}
                                <img src="https://placehold.co/600x400/222/fff?text=Sin+Imagen" alt="Sin imagen" class="card-image">
                        {% endif %}
                    </div>

                    <div class="card-content">
                        <div class="product-category">{{ producto.category.name|default:'Sin categoría' }}</div>
                        <h3 class="product-title">{{ producto.title }}</h3>
                        <p class="product-description">{{ producto.description|truncatewords:15 }}</p>
                        <div class="product-footer">
                            <div class="price-container">
                                <span class="price">${{ producto.price }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <!-- Estado de error -->
        <div class="empty-state">
            <div class="empty-icon"><i class="fas fa-exclamation-triangle"></i></div>
            <h2>Error al Cargar Productos</h2>
            <p>{{ error_message|default:"No se pudo conectar con el servidor. Inténtalo de nuevo." }}</p>
        </div>
    {% endif %}
</div>
{% endblock %}