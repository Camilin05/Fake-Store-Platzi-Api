{% extends 'base.html' %}

{% block title %} TIENDA AVILA'S - {{ es_edicion|yesno:"Editar,Agregar" }} Producto {% endblock %}

{% block content %}
<main>
    <h1>{{ es_edicion|yesno:"Editar,Agregar" }} Producto</h1>
    
    {% if es_edicion %}
        <div class="edit-info">
            <p>Estás editando el producto con <strong>ID #{{ producto_id }}</strong></p>
        </div>
    {% endif %}

    <!-- Barra de progreso visual -->
    <div class="progress-container">
        <div class="progress-bar" style="width: 0%;"></div>
        <div class="progress-text">0% Completado</div>
    </div>

    {% if messages %}
        {% for message in messages %}
            <div class="notification notification-{{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
    
    <form class="forms" method="post" action="">
        {% csrf_token %}
        
        <div class="form-group">
            {{ form.titulo.label_tag }}
            {{ form.titulo }}
            {% if form.titulo.errors %}<p class="error-message">{{ form.titulo.errors.0 }}</p>{% endif %}
        </div>

        <div class="form-group">
            {{ form.precio.label_tag }}
            {{ form.precio }}
            {% if form.precio.errors %}<p class="error-message">{{ form.precio.errors.0 }}</p>{% endif %}
        </div>

        <div class="form-group">
            {{ form.categoria.label_tag }}
            {{ form.categoria }}
            {% if form.categoria.errors %}<p class="error-message">{{ form.categoria.errors.0 }}</p>{% endif %}
        </div>

        <div class="form-group">
            {{ form.descripcion.label_tag }}
            {{ form.descripcion }}
            {% if form.descripcion.errors %}<p class="error-message">{{ form.descripcion.errors.0 }}</p>{% endif %}
        </div>

        <!-- Campo de imagen con botón de vista previa -->
        <div class="form-group">
            {{ form.imagen1.label_tag }}
            <div class="input-group">
                {{ form.imagen1 }}
                <button type="button" class="btn btn-sm preview-btn" data-input-id="{{ form.imagen1.id_for_label }}">
                    <i class="fas fa-eye"></i> Vista Previa
                </button>
            </div>
            {% if form.imagen1.errors %}<p class="error-message">{{ form.imagen1.errors.0 }}</p>{% endif %}
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">
                {{ es_edicion|yesno:"Actualizar Producto,Agregar Producto" }}
            </button>
            <a href="{% url 'fake_store_api:obtener_productos' %}" class="btn btn-secondary">Cancelar</a>
        </div>
    </form>
</main>

<!-- Modal para la vista previa de la imagen -->
<div id="imagePreviewModal" class="image-modal" style="display: none;">
    <div class="modal-content">
        <span class="modal-close" id="closePreviewModal">&times;</span>
        <img id="previewImage" src="" alt="Vista previa de la imagen">
    </div>
</div>
{% endblock %}

